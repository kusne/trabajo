<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Administrador</title>

  <link rel="stylesheet" href="./funciones/estilos/base.css" />
  <link rel="stylesheet" href="./administrador.css" />

  <style>
    .hidden { display:none !important; }
  </style>
</head>

<body>
  <div class="app">

    <!-- LOGIN -->
    <section id="loginContainer" class="card">
      <h1>Administrador</h1>
      <p class="muted">Ingresá con tu usuario.</p>

      <label>Email</label>
      <input type="email" id="loginEmail" placeholder="tu@mail.com" />

      <label>Contraseña</label>
      <input type="password" id="loginPassword" placeholder="••••••••" />

      <div id="loginError" class="error" style="display:none;"></div>

      <div class="row">
        <button id="btnLogin" class="btn-primary" type="button">Ingresar</button>
        <button id="btnForgot" class="btn-ghost" type="button">Olvidé mi contraseña</button>
      </div>
    </section>

    <!-- ADM -->
    <section id="admContainer" class="card" style="display:none;">
      <div class="topbar">
        <div class="tabs">
          <button type="button" class="tab-btn is-active" data-tab="ordenes">Órdenes</button>
          <button type="button" class="tab-btn" data-tab="guardia">Guardia</button>
          <button type="button" class="tab-btn" data-tab="inventario">Inventario</button>
          <button type="button" class="tab-btn" data-tab="libro">Libro memorándum</button>
        </div>

        <button id="btnLogout" class="btn-ghost" type="button">Cerrar sesión</button>
      </div>

      <!-- TAB: ORDENES -->
      <section id="tab-ordenes" class="tab-panel is-active">
        <h2>Órdenes</h2>

        <label for="ordenExistente">Órdenes Cargadas</label>
        <select id="ordenExistente"></select>

        <button type="button" id="btnEliminarOrden" class="btn-danger">Eliminar Orden Seleccionada</button>

        <label for="numOrden">Número de Orden</label>
        <input type="text" id="numOrden" placeholder="Ej: OOP2344/26" required />

        <label for="textoRef">Texto de referencia (opcional)</label>
        <input type="text" id="textoRef" placeholder="Ej: Orden semanal" />

        <label for="fechaVigencia">Fecha de vigencia (obligatoria)</label>
        <input type="date" id="fechaVigencia" required />

        <label for="fechaCaducidad">Fecha de caducidad (obligatoria o A FINALIZAR)</label>
        <input type="text" id="fechaCaducidad" placeholder="Ej: 30/01/2026 o A FINALIZAR" required />

        <div class="afinalizar-row">
          <input type="checkbox" id="aFinalizarCheckbox" />
          <span class="afinalizar-text">Marcar como “A FINALIZAR”</span>
        </div>

        <label for="franjas">Franjas (una por línea: HORARIO - LUGAR - TÍTULO)</label>
        <textarea id="franjas" rows="6" placeholder="07 a 11 hs - RN168 km18 - Control vehicular"></textarea>

        <div class="row">
          <button type="button" class="btn-primary" onclick="agregarOrden()">Guardar / Actualizar</button>
          <button type="button" id="btnPublicarOrdenes" class="btn-primary">Publicar Órdenes</button>
        </div>
      </section>

      <!-- TAB: GUARDIA (AJUSTADO A guardia.js + subtabsPatrullas.js) -->
      <section id="tab-guardia" class="tab-panel">
        <h2>Guardia</h2>
        <p class="muted">Armar Patrulla 1 / Patrulla 2 (personal + móvil/es + elementos) y registrar acciones: ingreso/retiro/presente/franco/constancia.</p>

        <div class="row" style="justify-content:space-between;">
          <div id="guardiaEstadoTxt" class="muted">Última actualización: —</div>
          <div class="row" style="margin-top:0;">
            <button type="button" id="btnGuardiaActualizar" class="btn-ghost">Actualizar</button>
            <button type="button" id="btnGuardiaGuardar" class="btn-primary">Guardar Guardia</button>
          </div>
        </div>

        <!-- Subsolapas -->
        <div class="row" style="margin-top:10px;">
          <button type="button" class="subtab-btn is-active" data-subtab="p1">Patrulla 1</button>
          <button type="button" class="subtab-btn" data-subtab="p2">Patrulla 2</button>
        </div>

        <!-- PATRULLA 1 -->
        <section id="patrulla-p1" class="subtab-panel is-active" style="margin-top:10px;">
          <h3>Patrulla 1</h3>

          <div class="row" style="margin-top:8px;">
            <button type="button" class="btn-primary" data-accion="Ingreso" data-p="p1">Ingreso</button>
            <button type="button" class="btn-ghost" data-accion="Retiro" data-p="p1">Retiro</button>
            <button type="button" class="btn-ghost" data-accion="Presente" data-p="p1">Presente</button>
            <button type="button" class="btn-ghost" data-accion="Franco" data-p="p1">Franco</button>
            <button type="button" class="btn-ghost" data-accion="Constancia" data-p="p1">Constancia</button>
          </div>

          <label class="top-label">Lugar / QTH</label>
          <select id="p1Lugar">
            <option value="">Seleccionar</option>
          </select>

          <label>Observaciones</label>
          <textarea id="p1Obs" rows="2" placeholder="Observaciones patrulla 1..."></textarea>

          <h4 style="margin-top:14px;">Personal</h4>
          <div id="p1Personal" class="list"></div>

          <h4 style="margin-top:14px;">Móvil/es</h4>
          <div id="p1Moviles" class="list"></div>

          <h4 style="margin-top:14px;">Elementos</h4>
          <div id="p1Elementos" class="list"></div>

          <h4 style="margin-top:14px;">Cartuchos (solo si hay escopeta)</h4>
          <div id="p1Cartuchos" class="list"></div>
        </section>

        <!-- PATRULLA 2 -->
        <section id="patrulla-p2" class="subtab-panel" style="margin-top:10px; display:none;">
          <h3>Patrulla 2</h3>

          <div class="row" style="margin-top:8px;">
            <button type="button" class="btn-primary" data-accion="Ingreso" data-p="p2">Ingreso</button>
            <button type="button" class="btn-ghost" data-accion="Retiro" data-p="p2">Retiro</button>
            <button type="button" class="btn-ghost" data-accion="Presente" data-p="p2">Presente</button>
            <button type="button" class="btn-ghost" data-accion="Franco" data-p="p2">Franco</button>
            <button type="button" class="btn-ghost" data-accion="Constancia" data-p="p2">Constancia</button>
          </div>

          <label class="top-label">Lugar / QTH</label>
          <select id="p2Lugar">
            <option value="">Seleccionar</option>
          </select>

          <label>Observaciones</label>
          <textarea id="p2Obs" rows="2" placeholder="Observaciones patrulla 2..."></textarea>

          <h4 style="margin-top:14px;">Personal</h4>
          <div id="p2Personal" class="list"></div>

          <h4 style="margin-top:14px;">Móvil/es</h4>
          <div id="p2Moviles" class="list"></div>

          <h4 style="margin-top:14px;">Elementos</h4>
          <div id="p2Elementos" class="list"></div>

          <h4 style="margin-top:14px;">Cartuchos (solo si hay escopeta)</h4>
          <div id="p2Cartuchos" class="list"></div>
        </section>

        <h3 style="margin-top:14px;">Salida JSON (preview)</h3>
        <pre id="guardiaJsonPreview" class="json-preview">{}</pre>
      </section>

      <!-- TAB: INVENTARIO -->
      <section id="tab-inventario" class="tab-panel">
        <h2>Inventario</h2>
        <p class="muted">Base de personal/móviles/elementos. Se renderiza dentro de este contenedor.</p>
        <div id="inventarioRoot"></div>
      </section>

      <!-- TAB: LIBRO MEMORÁNDUM -->
      <section id="tab-libro" class="tab-panel">
        <h2>Libro memorándum</h2>
        <p class="muted">Asientos en 3 columnas. Importa acciones desde Guardia para semi-automatizar.</p>

        <div class="row" style="margin-top:0;">
          <button type="button" id="btnLibroImportarGuardia" class="btn-ghost">Importar desde Guardia</button>
        </div>

        <div class="grid-3col">
          <div>
            <label class="top-label">Causa</label>
            <select id="libroCausa">
              <option value="">Seleccionar</option>
              <option value="Ingreso">Ingreso</option>
              <option value="Retiro">Retiro</option>
              <option value="Presente">Presente</option>
              <option value="Franco">Franco</option>
              <option value="Constancia">Constancia</option>
            </select>
          </div>

          <div>
            <label class="top-label">Hora</label>
            <input id="libroHora" type="time" />
          </div>

          <div>
            <label class="top-label">Novedad / Referencia</label>
            <textarea
              id="libroNovedad"
              rows="3"
              placeholder="Ej: Móvil 10139 a cargo del Oficial Cardozo junto al Suboficial Aquino."
            ></textarea>
          </div>
        </div>

        <div class="row-actions">
          <button type="button" id="btnLibroAgregar" class="btn-primary">Agregar</button>
          <button type="button" id="btnLibroLimpiar" class="btn-ghost">Limpiar</button>
        </div>

        <h3>Últimos asientos</h3>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Causa</th>
                <th>Hora</th>
                <th>Novedad / Referencia</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="libroTbody">
              <tr><td colspan="4" class="muted">Sin asientos todavía.</td></tr>
            </tbody>
          </table>
        </div>

        <h3>Salida JSON (preview)</h3>
        <pre id="libroJsonPreview" class="json-preview">{}</pre>
      </section>

    </section>

    <!-- shared scripts (orden correcto) -->
    <script src="./funciones/js/storage.js"></script>
    <script src="./funciones/js/dom.js"></script>
    <script src="./funciones/js/uiValidacion.js"></script>
    <script src="./funciones/js/datos.js"></script>
    <script src="./funciones/js/ordersSync.js"></script>
    <script src="./funciones/js/eliminacion.js"></script>
    <script src="./funciones/js/caducidad.js"></script>

    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- adm -->
    <script type="module" src="./administrador.js"></script>

  </div>
</body>
</html>
